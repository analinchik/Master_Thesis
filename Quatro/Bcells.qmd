---
title: "B cells"
format: 
  html:
    embed-resources: true
    theme: flatly
    toc: true
    toc-depth: 3
    toc-expand: 3
    toc-title: Contents
    smooth-scroll: true
editor: visual
---

```{r}
#| echo: false
#| include: false
library(dplyr)
library(ggplot2)
library(tidyr)
library(readxl)
library(kableExtra)
library(ggpubr)
library(stringr)
library(VennDiagram)
```

```{r}
#| echo: false
#| include: false

# hl
Bcells_hl <- read.csv(file = '/Users/anastasialinchik/Desktop/Thesis/DATA/generated/Bcells_hl.tsv', header = T, sep = '\t')

#THIS LOADS THE NEW DATASET
human_complete <- read.csv(file = "/Users/anastasialinchik/Desktop/Thesis/DATA/generated/human_new.tsv", header = T, sep = '\t')

leadprot_uniprot <- human_complete %>% dplyr::select(Uniprot_entry_name, LeadProt) %>% distinct()

human_ptms <- human_complete %>% filter(ptm_class == 'Post-translational')

# MODIFICATIONS
oxPTMs <- read_excel(path = '/Users/anastasialinchik/Desktop/Thesis/table_oxPTMs.xlsx', sheet = 'oxPTMs')
oxPTMs <- oxPTMs %>%
  mutate(AAs_list = str_split(Specificity, ", ")) %>% dplyr::select(`Unimod #`, AAs_list) %>% rename(unimod_id = `Unimod #`)

lysine_acylation <- c(122, 1, 58, 1289, 747, 64)
AGE <- c(6, 907, 378)
```

cytoplasmic projects:

-   old B cells: PXD006570

-   young B cells:PXD006572

nuclear proteins:

-   old B cells:PXD006571

-   young B cells:PXD006576

there were 3 young donors and 3 elderly donors

```{r}
#| echo: false

human_complete_cyto_old <- human_complete %>% filter(project_id == 'PXD006570')
human_complete_cyto_young <- human_complete %>% filter(project_id == 'PXD006572')

human_complete_nuc_old <- human_complete %>% filter(project_id == 'PXD006571') 
human_complete_nuc_young <- human_complete %>% filter(project_id == 'PXD006576')

human_ptms_cyto_old <- human_complete %>% filter(project_id == 'PXD006570') %>% filter(ptm_class == 'Post-translational')
human_ptms_cyto_young <- human_complete %>% filter(project_id == 'PXD006572') %>% filter(ptm_class == 'Post-translational')

human_ptms_nuc_old <- human_complete %>% filter(project_id == 'PXD006571') %>% filter(ptm_class == 'Post-translational')
human_ptms_nuc_young <- human_complete %>% filter(project_id == 'PXD006576') %>% filter(ptm_class == 'Post-translational')
```

# Chaperones

Chaperones are part of the proteostasis network. Looking for more modifications in chaperones in ageing samples. This would indicate that damage of the proteostasis network is a feature of ageing.

Not significant for both nuc and cyto.

```{r}
#| echo: false
#| include: false
all_chaperones <- read_excel(path = '/Users/anastasialinchik/Desktop/Thesis/DATA/all_chaperones.xlsx', sheet = 'BREHME_TABLE S2A', skip = 8)

#repressed_chaperones <- read_excel(path = '/Users/anastasialinchik/Desktop/Thesis/DATA/subnetwork_chaperones.xlsx', sheet = 'BREHME_TABLE S3D', skip = 19)
#repressed_chaperones <- separate_wider_delim(repressed_chaperones, col = 'Label [Family]', names = c("gene_name", "family"), delim = " ")
#repressed_chaperones <- inner_join(repressed_chaperones, all_chaperones, by = join_by('Entrez-ID'))

#induced_chaperones <- read_excel(path = '/Users/anastasialinchik/Desktop/Thesis/DATA/subnetwork_chaperones.xlsx', sheet = 'BREHME_TABLE S3E', skip = 19)
#induced_chaperones <- separate_wider_delim(induced_chaperones, col = 'Label [Family]', names = c("gene_name", "family"), delim = " ")
#induced_chaperones <- inner_join(induced_chaperones, all_chaperones, by = join_by('Entrez-ID'))
```

General comparison of the number of modifications. Sum cytoplasm and nuclear (complete)

```{r}
#| echo: false
df1 <- rbind(human_complete_cyto_young, human_complete_nuc_young)
df2 <- rbind(human_complete_cyto_old, human_complete_nuc_old)

df1 <- df1 %>% 
  filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% 
  group_by(Uniprot_entry_name) %>% summarise(sum = sum(counts_norm_abund_len)) %>% 
  distinct() %>% mutate(group = 'young')
df2 <- df2 %>% 
  filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% 
  group_by(Uniprot_entry_name) %>% summarise(sum = sum(counts_norm_abund_len)) %>% 
  distinct() %>% mutate(group = 'old') %>% filter(Uniprot_entry_name %in% df1$Uniprot_entry_name)

df1 <- df1 %>% filter(Uniprot_entry_name %in% df2$Uniprot_entry_name)
df <- rbind(df1, df2)
df$group <- factor(df$group, levels = c('young', 'old'))

ggplot(df, aes(y = sum, x = group, fill = group)) +
  geom_boxplot(outliers = F, alpha = 0.7) +
  scale_y_continuous(labels = scales::label_number(scale = 1e5)) +
  scale_x_discrete(labels = c('young' = 'Young donors \n(B cells\' cytoplasm & nucleus)', 'old' = 'Elderly donors \n(B cells\' cytoplasm & nucleus)')) + 
  scale_fill_manual(values = c('young' = '#1a9850', 'old' = '#c51b7d')) + 
  labs(y = 'Sum of normalised counts (scaled by 1e5)') +
  theme_classic() + 
  theme(axis.title.x = element_blank(),
        axis.text = element_text(size = 14, family = "Lato"),
        axis.title = element_text(size = 14, family = "Lato"), 
        legend.position = 'none') 
```

```{r}
#| echo: false
wilcox.test(df1$sum, df2$sum)
```

```{r}
#| echo: false
print('young')
dim(df1)[1]
print('old')
dim(df2)[1]
```

Only the PTMs.

```{r}
#| echo: false
df1 <- rbind(human_ptms_cyto_young, human_ptms_nuc_young)
df2 <- rbind(human_ptms_cyto_old,human_ptms_nuc_old)

df1 <- df1 %>% 
  filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% 
  group_by(Uniprot_entry_name) %>% summarise(sum = sum(counts_norm_abund_len)) %>% 
  distinct() %>% mutate(group = 'young')
df2 <- df2 %>% 
  filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% 
  group_by(Uniprot_entry_name) %>% summarise(sum = sum(counts_norm_abund_len)) %>% 
  distinct() %>% mutate(group = 'old') %>% filter(Uniprot_entry_name %in% df1$Uniprot_entry_name)

df1 <- df1 %>% filter(Uniprot_entry_name %in% df2$Uniprot_entry_name)
df <- rbind(df1, df2)
df$group <- factor(df$group, levels = c('young', 'old'))

ggplot(df, aes(y = sum, x = group, fill = group)) +
  geom_boxplot(outliers = F, alpha = 0.7) +
  scale_y_continuous(labels = scales::label_number(scale = 1e5)) +
  labs(y = 'Sum of normalised counts (scaled by 1e5)') +
  scale_x_discrete(labels = c('young' = 'Young donors \n(B cells\' cytoplasm & nucleus)', 'old' = 'Elderly donors \n(B cells\' cytoplasm & nucleus)')) + 
  scale_fill_manual(values = c('young' = '#1a9850', 'old' = '#c51b7d')) + 
  theme_classic() + 
  theme(axis.title.x = element_blank(),
        axis.text = element_text(size = 14, family = "Lato"),
        axis.title = element_text(size = 14, family = "Lato"),
        legend.position = 'none') 
```

```{r}
#| echo: false
wilcox.test(df1$sum, df2$sum)
```

```{r}
#| echo: false
print('young')
dim(df1)[1]
print('old')
dim(df2)[1]
```

# Initial modifications

## Phosphorylation - not enough

```{r}
#| echo: false
df1 <- human_ptms_cyto_young %>% 
  filter(unimod_id == 21) %>% 
  filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% 
  group_by(Uniprot_entry_name) %>% summarise(sum = sum(counts_norm_abund_len)) %>% 
  distinct() %>% mutate(group = 'young')
df2 <- human_ptms_cyto_old %>% 
  filter(unimod_id == 21) %>% 
  filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% 
  group_by(Uniprot_entry_name) %>% summarise(sum = sum(counts_norm_abund_len)) %>% 
  distinct() %>% mutate(group = 'old') %>% filter(Uniprot_entry_name %in% df1$Uniprot_entry_name)

df <- rbind(df1, df2)
df$group <- factor(df$group, levels = c('young', 'old'))
ggplot(df, aes(y = sum, x = group)) +
  geom_boxplot(outliers = F) +
  scale_y_continuous(labels = scales::label_number(scale = 1e5)) +
  labs(y = 'Sum of normalised counts (scaled by 1e5)') +
  theme_classic() + 
  theme(axis.title.x = element_blank(),
        axis.text = element_text(size = 16, family = "Lato"),
        axis.title = element_text(size = 16, family = "Lato")) 
```

```{r}
#| echo: false
print('young')
dim(df1)[1]
print('old')
dim(df2)[1]
```

```{r}
#| echo: false
wilcox.test(df1$sum, df2$sum)
```

```{r}
#| echo: false
df1 <- human_ptms_nuc_young %>% 
  filter(unimod_id == 21) %>% 
  filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% 
  group_by(Uniprot_entry_name) %>% summarise(sum = sum(counts_norm_abund_len)) %>% 
  distinct() %>% mutate(group = 'young')
df2 <- human_ptms_nuc_old %>% 
  filter(unimod_id == 21) %>% 
  filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% 
  group_by(Uniprot_entry_name) %>% summarise(sum = sum(counts_norm_abund_len)) %>% 
  distinct() %>% mutate(group = 'old') %>% filter(Uniprot_entry_name %in% df1$Uniprot_entry_name)

df <- rbind(df1, df2)
df$group <- factor(df$group, levels = c('young', 'old'))
ggplot(df, aes(y = sum, x = group)) +
  geom_boxplot(outliers = F) +
  scale_y_continuous(labels = scales::label_number(scale = 1e5)) +
  labs(y = 'Sum of normalised counts (scaled by 1e5)') +
  theme_classic() + 
  theme(axis.title.x = element_blank(),
        axis.text = element_text(size = 16, family = "Lato"),
        axis.title = element_text(size = 16, family = "Lato")) 
```

```{r}
#| echo: false
print('young')
dim(df1)[1]
print('old')
dim(df2)[1]
```

```{r}
#| echo: false
wilcox.test(df1$sum, df2$sum)
```

## Acetylation - not enough

```{r}
#| echo: false
df1 <- human_ptms_cyto_young %>% 
  filter(unimod_id == 1) %>% 
  filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% 
  group_by(Uniprot_entry_name) %>% summarise(sum = sum(counts_norm_abund_len)) %>% 
  distinct() %>% mutate(group = 'young')
df2 <- human_ptms_cyto_old %>% 
  filter(unimod_id == 1) %>% 
  filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% 
  group_by(Uniprot_entry_name) %>% summarise(sum = sum(counts_norm_abund_len)) %>% 
  distinct() %>% mutate(group = 'old') %>% filter(Uniprot_entry_name %in% df1$Uniprot_entry_name)

df <- rbind(df1, df2)
ggplot(df, aes(y = sum, x = group)) +
  geom_boxplot(outliers = F) +
  scale_y_continuous(labels = scales::label_number(scale = 1e5)) +
  labs(y = 'Sum of normalised counts (scaled by 1e5)') +
  theme_classic() + 
  theme(axis.title.x = element_blank(),
        axis.text = element_text(size = 16, family = "Lato"),
        axis.title = element_text(size = 16, family = "Lato")) 
```

```{r}
#| echo: false
print('young')
dim(df1)[1]
print('old')
dim(df2)[1]
```

```{r}
#| echo: false
wilcox.test(df1$sum, df2$sum)
```

```{r}
#| echo: false
df1 <- human_ptms_nuc_young %>% 
  filter(unimod_id == 1) %>% 
  filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% 
  group_by(Uniprot_entry_name) %>% summarise(sum = sum(counts_norm_abund_len)) %>% 
  distinct() %>% mutate(group = 'young')
df2 <- human_ptms_nuc_old %>% 
  filter(unimod_id == 1) %>% 
  filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% 
  group_by(Uniprot_entry_name) %>% summarise(sum = sum(counts_norm_abund_len)) %>% 
  distinct() %>% mutate(group = 'old') %>% filter(Uniprot_entry_name %in% df1$Uniprot_entry_name)

df <- rbind(df1, df2)
df$group <- factor(df$group, levels = c('young', 'old'))
ggplot(df, aes(y = sum, x = group)) +
  geom_boxplot(outliers = F) +
  scale_y_continuous(labels = scales::label_number(scale = 1e5)) +
  labs(y = 'Sum of normalised counts (scaled by 1e5)') +
  theme_classic() + 
  theme(axis.title.x = element_blank(),
        axis.text = element_text(size = 16, family = "Lato"),
        axis.title = element_text(size = 16, family = "Lato")) 
```

```{r}
#| echo: false
print('young')
dim(df1)[1]
print('old')
dim(df2)[1]
```

```{r}
#| echo: false
wilcox.test(df1$sum, df2$sum)
```

## Methylation - not enough

```{r}
#| echo: false
df1 <- human_ptms_cyto_young %>% 
  filter(unimod_id == 34) %>% 
  filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% 
  group_by(Uniprot_entry_name) %>% summarise(sum = sum(counts_norm_abund_len)) %>% 
  distinct() %>% mutate(group = 'young')
df2 <- human_ptms_cyto_old %>% 
  filter(unimod_id == 34) %>% 
  filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% 
  group_by(Uniprot_entry_name) %>% summarise(sum = sum(counts_norm_abund_len)) %>% 
  distinct() %>% mutate(group = 'old') %>% filter(Uniprot_entry_name %in% df1$Uniprot_entry_name)

df <- rbind(df1, df2)
ggplot(df, aes(y = sum, x = group)) +
  geom_boxplot(outliers = F) +
  scale_y_continuous(labels = scales::label_number(scale = 1e5)) +
  labs(y = 'Sum of normalised counts (scaled by 1e5)') +
  theme_classic() + 
  theme(axis.title.x = element_blank(),
        axis.text = element_text(size = 16, family = "Lato"),
        axis.title = element_text(size = 16, family = "Lato")) 
```

```{r}
#| echo: false
print('young')
dim(df1)[1]
print('old')
dim(df2)[1]
```

```{r}
#| echo: false
df1 <- human_ptms_nuc_young %>% 
  filter(unimod_id == 34) %>% 
  filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% 
  group_by(Uniprot_entry_name) %>% summarise(sum = sum(counts_norm_abund_len)) %>% 
  distinct() %>% mutate(group = 'young')
df2 <- human_ptms_nuc_old %>% 
  filter(unimod_id == 34) %>% 
  filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% 
  group_by(Uniprot_entry_name) %>% summarise(sum = sum(counts_norm_abund_len)) %>% 
  distinct() %>% mutate(group = 'old') %>% filter(Uniprot_entry_name %in% df1$Uniprot_entry_name)

df <- rbind(df1, df2)
df$group <- factor(df$group, levels = c('young', 'old'))
ggplot(df, aes(y = sum, x = group)) +
  geom_boxplot(outliers = F) +
  scale_y_continuous(labels = scales::label_number(scale = 1e5)) +
  labs(y = 'Sum of normalised counts (scaled by 1e5)') +
  theme_classic() + 
  theme(axis.title.x = element_blank(),
        axis.text = element_text(size = 16, family = "Lato"),
        axis.title = element_text(size = 16, family = "Lato")) 
```

```{r}
#| echo: false
print('young')
dim(df1)[1]
print('old')
dim(df2)[1]
```

## oxPTMs

```{r}
#| echo: false
df1 <- human_ptms_nuc_young %>% filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% distinct(Uniprot_entry_name)
df2 <- human_ptms_nuc_old %>% filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% distinct(Uniprot_entry_name)
all_nuc <- inner_join(df1, df2, by = join_by(Uniprot_entry_name))

df3 <- human_ptms_cyto_young %>% filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% distinct(Uniprot_entry_name)
df4 <- human_ptms_cyto_old %>% filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% distinct(Uniprot_entry_name)
all_cyto <- inner_join(df3, df4, by = join_by(Uniprot_entry_name))
```

```{r}
#| echo: false
df1 <- human_complete_cyto_young %>% 
  filter(unimod_id %in% oxPTMs$unimod_id & ptm_res %in% oxPTMs$AAs_list) %>% 
  filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% 
  group_by(Uniprot_entry_name) %>% summarise(sum = sum(counts_norm_abund_len)) %>% 
  distinct() %>% mutate(group = 'young') 
df2 <- human_complete_cyto_old %>% 
  filter(unimod_id %in% oxPTMs$unimod_id & ptm_res %in% oxPTMs$AAs_list) %>% 
  filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% 
  group_by(Uniprot_entry_name) %>% summarise(sum = sum(counts_norm_abund_len)) %>% 
  distinct() %>% mutate(group = 'old') %>% filter(Uniprot_entry_name %in% df1$Uniprot_entry_name)

df1 <- df1 %>% filter(Uniprot_entry_name %in% df2$Uniprot_entry_name)

df <- rbind(df1, df2)
df$group <- factor(df$group, levels = c('young', 'old'))
ggplot(df, aes(y = sum, x = group, fill = group)) +
  geom_boxplot(outliers = F, alpha = 0.7) +
  scale_y_continuous(labels = scales::label_number(scale = 1e5)) +
  scale_x_discrete(labels = c('young' = 'Young donors \n(B cells\' cytoplasm)', 'old' = 'Elderly donors \n(B cells\' cytoplasm)')) + 
  scale_fill_manual(values = c('young' = '#1a9850', 'old' = '#c51b7d')) + 
  labs(y = 'Sum of normalised counts (scaled by 1e5)')+
  theme_classic() + 
  theme(axis.title.x = element_blank(),
        axis.text = element_text(size = 16, family = "Lato"),
        axis.title = element_text(size = 16, family = "Lato"),
        legend.position = 'none') 
```

```{r}
#| echo: false
print('young')
dim(df1)[1]
print('old')
dim(df2)[1]
```

```{r}
#| echo: false
wilcox.test(df1$sum, df2$sum)
```

```{r}
#| echo: false
df1 <- human_complete_nuc_young %>% 
  filter(unimod_id %in% oxPTMs$unimod_id & ptm_res %in% oxPTMs$AAs_list) %>% 
  filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% 
  group_by(Uniprot_entry_name) %>% summarise(sum = sum(counts_norm_abund_len)) %>% 
  distinct() %>% mutate(group = 'young')
df2 <- human_complete_nuc_old %>% 
  filter(unimod_id %in% oxPTMs$unimod_id & ptm_res %in% oxPTMs$AAs_list) %>% 
  filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% 
  group_by(Uniprot_entry_name) %>% summarise(sum = sum(counts_norm_abund_len)) %>% 
  distinct() %>% mutate(group = 'old') %>% filter(Uniprot_entry_name %in% df1$Uniprot_entry_name)

df1 <- df1 %>% filter(Uniprot_entry_name %in% df2$Uniprot_entry_name)
df <- rbind(df1, df2)
df$group <- factor(df$group, levels = c('young', 'old'))
ggplot(df, aes(y = sum, x = group, fill = group)) +
  geom_boxplot(outliers = F, alpha = 0.7) +
  scale_y_continuous(labels = scales::label_number(scale = 1e5)) +
  scale_x_discrete(labels = c('young' = 'Young donors \n(B cells\' nucleus)', 'old' = 'Elderly donors \n(B cells\' nucleus)')) + 
  scale_fill_manual(values = c('young' = '#1a9850', 'old' = '#c51b7d')) + 
  labs(y = 'Sum of normalised counts (scaled by 1e5)')+
  theme_classic() + 
  theme(axis.title.x = element_blank(),
        axis.text = element_text(size = 16, family = "Lato"),
        axis.title = element_text(size = 16, family = "Lato"),
        legend.position = 'none')
```

```{r}
#| echo: false
print('young')
dim(df1)[1]
print('old')
dim(df2)[1]
```

```{r}
#| echo: false
wilcox.test(df1$sum, df2$sum)
```

## K acylation - NO

NOT FOUND

## AGEs - NO

NOT FOUND

## Ubiquitination - not enough

```{r}
#| echo: false
df1 <- human_complete_cyto_young %>% 
  filter(unimod_id == 121) %>% 
  filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% 
  group_by(Uniprot_entry_name) %>% summarise(sum = sum(counts_norm_abund_len)) %>% 
  distinct() %>% mutate(group = 'young')
df2 <- human_complete_cyto_old %>% 
  filter(unimod_id == 121) %>% 
  filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% 
  group_by(Uniprot_entry_name) %>% summarise(sum = sum(counts_norm_abund_len)) %>% 
  distinct() %>% mutate(group = 'old') %>% filter(Uniprot_entry_name %in% df1$Uniprot_entry_name)

df <- rbind(df1, df2)
df$group <- factor(df$group, levels = c('young', 'old'))
ggplot(df, aes(y = sum, x = group)) +
  geom_boxplot(outliers = F) +
  scale_y_continuous(labels = scales::label_number(scale = 1e5)) +
  labs(y = 'Sum of normalised counts (scaled by 1e5)')+
  theme_classic() + 
  theme(axis.title.x = element_blank(),
        axis.text = element_text(size = 16, family = "Lato"),
        axis.title = element_text(size = 16, family = "Lato")) 
```

```{r}
#| echo: false
print('young')
dim(df1)[1]
print('old')
dim(df2)[1]
```

```{r}
#| echo: false
df1 <- human_complete_nuc_young %>% 
  filter(unimod_id == 121) %>% 
  filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% 
  group_by(Uniprot_entry_name) %>% summarise(sum = sum(counts_norm_abund_len)) %>% 
  distinct() %>% mutate(group = 'young')
df2 <- human_complete_nuc_old %>% 
  filter(unimod_id == 121) %>% 
  filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% 
  group_by(Uniprot_entry_name) %>% summarise(sum = sum(counts_norm_abund_len)) %>% 
  distinct() %>% mutate(group = 'old') %>% filter(Uniprot_entry_name %in% df1$Uniprot_entry_name)

df <- rbind(df1, df2)
df$group <- factor(df$group, levels = c('young', 'old'))
ggplot(df, aes(y = sum, x = group)) +
  geom_boxplot(outliers = F) +
  scale_y_continuous(labels = scales::label_number(scale = 1e5)) +
  labs(y = 'Sum of normalised counts (scaled by 1e5)')+
  theme_classic() + 
  theme(axis.title.x = element_blank(),
        axis.text = element_text(size = 16, family = "Lato"),
        axis.title = element_text(size = 16, family = "Lato"))
```

The previously selected modifications do not work. Are there any modification enrichments here at all?

# Fold change

In which **chaperones** was there an increase or decrease in PTMs? This is using the fold change \>2 or \< 0.5

First the cytoplasm:

```{r}
#| echo: false
df1 <- human_ptms_cyto_young %>% filter(ptm_class == 'Post-translational') %>% 
  group_by(Uniprot_entry_name) %>%
  summarise(sum =sum(counts_norm_abund_len)) %>% filter(Uniprot_entry_name %in% all_chaperones$Uniprot)

df2 <- human_ptms_cyto_old %>% filter(ptm_class == 'Post-translational') %>% 
  group_by(Uniprot_entry_name) %>%
  summarise(sum =sum(counts_norm_abund_len)) %>% filter(Uniprot_entry_name %in% all_chaperones$Uniprot)

df3 <- inner_join(df1, df2, by = join_by(Uniprot_entry_name),  suffix = c('_young', '_old')) %>% 
  mutate(change = sum_old/sum_young) %>% filter(change >2) %>%
  arrange(desc(change))

kable(df3, caption = 'Chaperones in which PTMs increased (cytoplasm)') %>% 
  kable_classic(full_width = F)

df4 <- inner_join(df1, df2, by = join_by(Uniprot_entry_name),  suffix = c('_young', '_old')) %>% 
  mutate(change = sum_old/sum_young) %>% filter(change <0.5) %>%
  arrange(desc(change))

kable(df4, caption = 'Chaperones in which PTMs decreased (cytoplasm)') %>% 
  kable_classic(full_width = F)
```

```{r}
#| echo: false
#| eval: false
write.table(df3$Uniprot_entry_name, file = '/Users/anastasialinchik/Downloads/up_in_old.tsv', row.names = F, sep="\t", quote = F)
write.table(df4$Uniprot_entry_name, file = '/Users/anastasialinchik/Downloads/down_in_old.tsv', row.names = F, sep="\t", quote = F)
```

Now the nucleus:

```{r}
#| echo: false
df1 <- human_ptms_nuc_young %>% filter(ptm_class == 'Post-translational') %>% 
  group_by(Uniprot_entry_name) %>%
  summarise(sum =sum(counts_norm_abund_len)) %>% filter(Uniprot_entry_name %in% all_chaperones$Uniprot)

df2 <- human_ptms_nuc_old %>% filter(ptm_class == 'Post-translational') %>% 
  group_by(Uniprot_entry_name) %>%
  summarise(sum =sum(counts_norm_abund_len)) %>% filter(Uniprot_entry_name %in% all_chaperones$Uniprot)

df3 <- inner_join(df1, df2, by = join_by(Uniprot_entry_name),  suffix = c('_young', '_old')) %>% 
  mutate(change = sum_old/sum_young) %>% filter(change >2) %>%
  arrange(desc(change))

kable(df3, caption = 'Chaperones in which PTMs increased (nucleus)') %>% 
  kable_classic(full_width = F)

df4 <- inner_join(df1, df2, by = join_by(Uniprot_entry_name),  suffix = c('_young', '_old')) %>% 
  mutate(change = sum_old/sum_young) %>% filter(change <0.5) %>%
  arrange(desc(change))

kable(df4, caption = 'Chaperones in which PTMs decreased (nucleus)') %>% 
  kable_classic(full_width = F)
```

How many and which chaperones were identified in the cytoplasm of young and old?

```{r}
#| echo: false
df1 <- human_complete_nuc_young %>% filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% distinct(Uniprot_entry_name)
df2 <- human_complete_nuc_old %>% filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% distinct(Uniprot_entry_name)
all_nuc <- inner_join(df1, df2, by = join_by(Uniprot_entry_name))

df3 <- human_complete_cyto_young %>% filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% distinct(Uniprot_entry_name)
df4 <- human_complete_cyto_old %>% filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% distinct(Uniprot_entry_name)
all_cyto <- inner_join(df3, df4, by = join_by(Uniprot_entry_name))

kable(df1, caption = 'Nuclear (young)') %>% 
  kable_classic(full_width = F)

kable(df2, caption = 'Nuclear (old)') %>% 
  kable_classic(full_width = F)

kable(all_nuc, caption = 'In both nuclear samples') %>% 
  kable_classic(full_width = F)

paste('Nuclear chaperones (young): ', dim(df1)[1])
paste('Nuclear chaperones (old): ', dim(df2)[1])
paste('Nuclear chaperones (both): ', dim(all_nuc)[1])

kable(df3, caption = 'Cytoplasmic (young)') %>% 
  kable_classic(full_width = F)

kable(df1, caption = 'Cytoplasmic (old)') %>% 
  kable_classic(full_width = F)

kable(all_cyto, caption = 'In both cytoplasmic samples') %>% 
  kable_classic(full_width = F)

paste('Cytoplasmic chaperones (young): ', dim(df3)[1])
paste('Cytoplasmic chaperones (old): ', dim(df4)[1])
paste('Cytoplasmic chaperones (both): ', dim(all_cyto)[1])
```

For chaperones (nucleus) that are present in both young and old, wich PTMs increase or decrease:

```{r}
#| echo: false
df1 <- human_ptms_nuc_young %>% 
  filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% 
  group_by(ptm_name) %>%
  summarise(sum =sum(counts_norm_abund_len)) %>% arrange(desc(sum))

df2 <- human_ptms_nuc_old %>% 
  filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% 
  group_by(ptm_name) %>%
  summarise(sum =sum(counts_norm_abund_len)) %>% arrange(desc(sum))

df3 <- inner_join(df1, df2, by = join_by(ptm_name),  suffix = c('_young', '_old')) %>% 
  mutate(change = sum_old/sum_young) %>% filter(change >2) %>%
  arrange(desc(change))

kable(df3, caption = 'PTMs that increase in chaperones found in the nucleus') %>% 
  kable_classic(full_width = F)

df4 <- inner_join(df1, df2, by = join_by(ptm_name),  suffix = c('_young', '_old')) %>% 
  mutate(change = sum_old/sum_young) %>% filter(change <0.5) %>%
  arrange(desc(change))

kable(df4, caption = 'PTMs that decrease in chaperones found in the nucleus') %>% 
  kable_classic(full_width = F)
```

Now not limited to PTMs (still nucleus)

```{r}
#| echo: false
df1 <- human_complete_nuc_young %>% 
  filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% 
  group_by(ptm_name) %>%
  summarise(sum =sum(counts_norm_abund_len)) %>% arrange(desc(sum))

df2 <- human_complete_nuc_old %>% 
  filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% 
  group_by(ptm_name) %>%
  summarise(sum =sum(counts_norm_abund_len)) %>% arrange(desc(sum))

df3 <- inner_join(df1, df2, by = join_by(ptm_name),  suffix = c('_young', '_old')) %>% 
  mutate(change = sum_old/sum_young) %>% filter(change >2) %>%
  arrange(desc(change))

kable(df3, caption = 'All modifications that increase in chaperones found in the nucleus') %>% 
  kable_classic(full_width = F)

df4 <- inner_join(df1, df2, by = join_by(ptm_name),  suffix = c('_young', '_old')) %>% 
  mutate(change = sum_old/sum_young) %>% filter(change <0.5) %>%
  arrange(desc(change))

kable(df4, caption = 'All modifications that decrease in chaperones found in the nucleus') %>% 
  kable_classic(full_width = F)
```

Now the cytoplasm.

```{r}
#| echo: false
df1 <- human_ptms_cyto_young %>% 
  filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% 
  group_by(ptm_name) %>%
  summarise(sum =sum(counts_norm_abund_len)) %>% arrange(desc(sum))

df2 <- human_ptms_cyto_old %>% 
  filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% 
  group_by(ptm_name) %>%
  summarise(sum =sum(counts_norm_abund_len)) %>% arrange(desc(sum))

df3 <- inner_join(df1, df2, by = join_by(ptm_name),  suffix = c('_young', '_old')) %>% 
  mutate(change = sum_old/sum_young) %>% filter(change >2) %>%
  arrange(desc(change))

kable(df3, caption = 'PTMs that increase in chaperones found in the cytoplasm') %>% 
  kable_classic(full_width = F)

df4 <- inner_join(df1, df2, by = join_by(ptm_name),  suffix = c('_young', '_old')) %>% 
  mutate(change = sum_old/sum_young) %>% filter(change <0.5) %>%
  arrange(desc(change))

kable(df4, caption = 'PTMs that decrease in chaperones found in the cytoplasm') %>% 
  kable_classic(full_width = F)
```

Now not limited to PTMs

```{r}
#| echo: false
df1 <- human_complete_cyto_young %>% 
  filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% 
  group_by(ptm_name) %>%
  summarise(sum =sum(counts_norm_abund_len)) %>% arrange(desc(sum))

df2 <- human_complete_cyto_old %>% 
  filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% 
  group_by(ptm_name) %>%
  summarise(sum =sum(counts_norm_abund_len)) %>% arrange(desc(sum))

df3 <- inner_join(df1, df2, by = join_by(ptm_name),  suffix = c('_young', '_old')) %>% 
  mutate(change = sum_old/sum_young) %>% filter(change >2) %>%
  arrange(desc(change))

kable(df3, caption = 'All modifications that increase in chaperones found in the cytoplasm') %>% 
  kable_classic(full_width = F)

df4 <- inner_join(df1, df2, by = join_by(ptm_name),  suffix = c('_young', '_old')) %>% 
  mutate(change = sum_old/sum_young) %>% filter(change <0.5) %>%
  arrange(desc(change))

kable(df4, caption = 'All modifications that decrease in chaperones found in the cytoplasm') %>% 
  kable_classic(full_width = F)
```

# New modifications

These are the modifications for which the fold change was \> 2 and the sample size was large enough and both young and old samples contained the same chaperones.

## \[35\]

```{r}
#| echo: false
df1 <- human_complete_cyto_young %>% 
  filter(unimod_id == 35) %>% 
  filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% 
  group_by(Uniprot_entry_name) %>% summarise(sum = sum(counts_norm_abund_len)) %>% 
  distinct() %>% mutate(group = 'young') 
df2 <- human_complete_cyto_old %>% 
  filter(unimod_id == 35) %>% 
  filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% 
  group_by(Uniprot_entry_name) %>% summarise(sum = sum(counts_norm_abund_len)) %>% 
  distinct() %>% mutate(group = 'old') %>% filter(Uniprot_entry_name %in% df1$Uniprot_entry_name)

df1 <- df1 %>% filter(Uniprot_entry_name %in% df2$Uniprot_entry_name)

df <- rbind(df1, df2)
df$group <- factor(df$group, levels = c('young', 'old'))
ggplot(df, aes(y = sum, x = group)) +
  geom_boxplot(outliers = F) +
  scale_y_continuous(labels = scales::label_number(scale = 1e5)) +
  labs(y = 'Sum of normalised counts (scaled by 1e5)')+
  theme_classic() + 
  theme(axis.title.x = element_blank(),
        axis.text = element_text(size = 16, family = "Lato"),
        axis.title = element_text(size = 16, family = "Lato")) 
```

```{r}
#| echo: false
wilcox.test(df1$sum, df2$sum)
```

```{r}
#| echo: false
print("Number of chaperones")
dim(df)
```

## \[7\]

```{r}
#| echo: false
df1 <- human_complete_cyto_young %>% 
  filter(unimod_id == 7) %>% 
  filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% 
  group_by(Uniprot_entry_name) %>% summarise(sum = sum(counts_norm_abund_len)) %>% 
  distinct() %>% mutate(group = 'young') 
df2 <- human_complete_cyto_old %>% 
  filter(unimod_id == 7) %>% 
  filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% 
  group_by(Uniprot_entry_name) %>% summarise(sum = sum(counts_norm_abund_len)) %>% 
  distinct() %>% mutate(group = 'old') %>% filter(Uniprot_entry_name %in% df1$Uniprot_entry_name)

df1 <- df1 %>% filter(Uniprot_entry_name %in% df2$Uniprot_entry_name)

df <- rbind(df1, df2)
df$group <- factor(df$group, levels = c('young', 'old'))
ggplot(df, aes(y = sum, x = group)) +
  geom_boxplot(outliers = F) +
  scale_y_continuous(labels = scales::label_number(scale = 1e5)) +
  labs(y = 'Sum of normalised counts (scaled by 1e5)')+
  theme_classic() + 
  theme(axis.title.x = element_blank(),
        axis.text = element_text(size = 16, family = "Lato"),
        axis.title = element_text(size = 16, family = "Lato")) 
```

```{r}
#| echo: false
wilcox.test(df1$sum, df2$sum)
```

```{r}
#| echo: false
print("Number of chaperones")
dim(df)
```

## \[1263\]

```{r}
#| echo: false
df1 <- human_complete_cyto_young %>% 
  filter(unimod_id == 1263) %>% 
  filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% 
  group_by(Uniprot_entry_name) %>% summarise(sum = sum(counts_norm_abund_len)) %>% 
  distinct() %>% mutate(group = 'young') 
df2 <- human_complete_cyto_old %>% 
  filter(unimod_id == 1263) %>% 
  filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% 
  group_by(Uniprot_entry_name) %>% summarise(sum = sum(counts_norm_abund_len)) %>% 
  distinct() %>% mutate(group = 'old') %>% filter(Uniprot_entry_name %in% df1$Uniprot_entry_name)

df1 <- df1 %>% filter(Uniprot_entry_name %in% df2$Uniprot_entry_name)

df <- rbind(df1, df2)
df$group <- factor(df$group, levels = c('young', 'old'))
ggplot(df, aes(y = sum, x = group)) +
  geom_boxplot(outliers = F) +
  scale_y_continuous(labels = scales::label_number(scale = 1e5)) +
  labs(y = 'Sum of normalised counts (scaled by 1e5)')+
  theme_classic() + 
  theme(axis.title.x = element_blank(),
        axis.text = element_text(size = 16, family = "Lato"),
        axis.title = element_text(size = 16, family = "Lato")) 
```

```{r}
#| echo: false
wilcox.test(df1$sum, df2$sum)
```

```{r}
#| echo: false
print("Number of chaperones")
dim(df)
```

## \[4\]

```{r}
#| echo: false
df1 <- human_complete_cyto_young %>% 
  filter(unimod_id == 4) %>% 
  filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% 
  group_by(Uniprot_entry_name) %>% summarise(sum = sum(counts_norm_abund_len)) %>% 
  distinct() %>% mutate(group = 'young') 
df2 <- human_complete_cyto_old %>% 
  filter(unimod_id == 4) %>% 
  filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% 
  group_by(Uniprot_entry_name) %>% summarise(sum = sum(counts_norm_abund_len)) %>% 
  distinct() %>% mutate(group = 'old') %>% filter(Uniprot_entry_name %in% df1$Uniprot_entry_name)

df1 <- df1 %>% filter(Uniprot_entry_name %in% df2$Uniprot_entry_name)

df <- rbind(df1, df2)
df$group <- factor(df$group, levels = c('young', 'old'))
ggplot(df, aes(y = sum, x = group)) +
  geom_boxplot(outliers = F) +
  scale_y_continuous(labels = scales::label_number(scale = 1e5)) +
  labs(y = 'Sum of normalised counts (scaled by 1e5)')+
  theme_classic() + 
  theme(axis.title.x = element_blank(),
        axis.text = element_text(size = 16, family = "Lato"),
        axis.title = element_text(size = 16, family = "Lato")) 
```

```{r}
#| echo: false
wilcox.test(df1$sum, df2$sum)
```

```{r}
#| echo: false
print("Number of chaperones")
dim(df)
```

## \[28\]

```{r}
#| echo: false
df1 <- human_complete_cyto_young %>% 
  filter(unimod_id == 28) %>% 
  filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% 
  group_by(Uniprot_entry_name) %>% summarise(sum = sum(counts_norm_abund_len)) %>% 
  distinct() %>% mutate(group = 'young') 
df2 <- human_complete_cyto_old %>% 
  filter(unimod_id == 28) %>% 
  filter(Uniprot_entry_name %in% all_chaperones$Uniprot) %>% 
  group_by(Uniprot_entry_name) %>% summarise(sum = sum(counts_norm_abund_len)) %>% 
  distinct() %>% mutate(group = 'old') %>% filter(Uniprot_entry_name %in% df1$Uniprot_entry_name)

df1 <- df1 %>% filter(Uniprot_entry_name %in% df2$Uniprot_entry_name)

df <- rbind(df1, df2)
df$group <- factor(df$group, levels = c('young', 'old'))
ggplot(df, aes(y = sum, x = group)) +
  geom_boxplot(outliers = F) +
  scale_y_continuous(labels = scales::label_number(scale = 1e5)) +
  labs(y = 'Sum of normalised counts (scaled by 1e5)')+
  theme_classic() + 
  theme(axis.title.x = element_blank(),
        axis.text = element_text(size = 16, family = "Lato"),
        axis.title = element_text(size = 16, family = "Lato")) 
```

```{r}
#| echo: false
wilcox.test(df1$sum, df2$sum)
```

```{r}
#| echo: false
print("Number of chaperones")
dim(df)
```
